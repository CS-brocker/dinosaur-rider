# 운영체제 스터디 2주차 (1주차) 공통 주제

# CDN

Client → Edge Server (CDN) → Origin Server

## Edge Server

1. 캐시에 컨텐츠가 있으면 반환
2. 원본에서 조회해서 반환 + 캐시에 저장

## [settings.cashwalk.io/cashwalk/os/settings.json](http://settings.cashwalk.io/cashwalk/os/settings.json) 요청을 한다면

### 1. DNS 질의

- settings-cashwalk.cloudfront.net 과 같은 CNAME 으로 응답
- Anycast + Geo/DNS 라우팅  기술을 사용해 가장 가까운 POP(엣지)의 IP를 받음.

### 2. 전송 계층 연결 + TLS

- CDN이 올바른 인증서를 선택하고, HTTP/2 또는 HTTP/3 연결을 결정
- TLS handshake 후 암호화된 채널 성립

→ 엣지 서버에서의 요청 처리

### 3. 보안/접근 제어 1차 게이트

- IP/Geo 제한, WAF 룰, Bot 차단, Signed URL/Cookie 등을 검증
- 차단/redirect 등 즉시 응답

### 4. Cache key 생성 및 Cache 조회

- Hit & Fresh: TTL이 유효한 것으로 즉시 응답
- Hit & Stale
    - stale-while-revalidate 허용시 먼저 낡은 응답 제공하고, 백그라운드에서 갱신시킴.
    - 아니면 다음 단계로
- Hit & Needs-Validation: Etag/Last-Modified 있으면 조건부 재검증
- Miss: 없으면 원본으로 패스

→ 원본으로의 Proxy

### 5. 원본 요청 최적화

- keep-Alive 연결 풀, HTTP/2 다중화, Request coalescing
- 대용량/동영상의 경우 Range 요청, 압축 협상(gzip, br 등), 헤더 필터링

→ 다시 CDN

### 6. 원본 응답 수신 & 캐시 정책 적용

- CDN이 Cache-Control, Expires, ETag, Last-Modified를 해석해 TTL/재검증 정책 결정
- Cache-Control이 no-store/private 이면 캐싱하지 않거나 사용자별로 처리
- 필요시 이미지 사이즈/포맷 변환 또는 헤더 추가/제거

### 7. store & stream

- 바이트 수신 즉시 클라이언트로 스트리밍하며 동시에 캐시에 저장 → 대용량에서도 낮은 TTFB(Time to Fire Bye)
- 메타데이터를 함께 저장

### 8. 클라이언트에게 응답

## 추가로 궁금한 부분

- DNS 질의에서 Anycast + Geo/DNS 라우팅은 무엇이고, 어떻게 동작하는지
- CNAME은 무엇인지?  A, AAAA 와 주소와 뭐가 다르고 왜 다른지?
- HTTP/2, HTTP/3 차이
- HTTP/2 다중화