## iOS에서는 어떻게 변수를 메모리에 저장할까?

![image.png](attachment:1c72ce18-666f-4a3b-827c-db8be5ea2ff7:image.png)

### <Stack>

- LIFO. 잠깐 쌓아두고 버리는 공간
- 컴파일 시점에 함수 호출시마다 Stack frame을 만들고 함수가 끝나면 메모리에서 해제됨 (OS가 자동으로 해제합니다)
- 접근이 빠르고 메모리 크기가 작음
- 핵심 이슈: Stack overflow

### <Heap>

- 런타임에 필요한 공간만큼 요청해서 사용 (수동으로 **ARC**가 관리
    - ARC (Automatic Reference Counting)
        - Swift 컴파일러의 기능으로, 컴파일 타임에 적절히 retain, release를 넣어줌
- 참조 타입이 저장됨 (class 인스턴스, Array, String, 클로저..)
- 접근이 느리지만 메모리 크기가 stack에 비해 상대적으로 큼
- 핵심 이슈: Memory Leak

### ARC의 메모리 관리 방식과 memory leak 발생 과정

ARC는 모든 heap 객체마다 아래처럼 메타 데이터를 붙입니다. 

![image.png](attachment:337e8e34-d64c-43fc-b960-e153ba5d5c3a:15ffda6a-d6ec-49c6-844e-d7ae4e28dfd8.png)

- strong refCount: 정수 형태의 강한 참조 개수 (ex. 3)
- weak reference table entry: weak 포인트 리스트 (ex. [pnt1, pnt2…])

#### Memory leak 예시 (순환 참조)

![image.png](attachment:cb2a72cc-18e8-4050-934e-5764aa3c1fa2:image.png)

#### Memory leak 발생하지 않는 예시 (weak)

![image.png](attachment:12de6786-964f-42b9-af24-b06f55a26641:image.png)
